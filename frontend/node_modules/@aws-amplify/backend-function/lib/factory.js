import { functionOutputKey, } from '@aws-amplify/backend-output-schemas';
import { AttributionMetadataStorage } from '@aws-amplify/backend-output-storage';
import { AmplifyUserError, CallerDirectoryExtractor, TagName, } from '@aws-amplify/platform-core';
import { Duration, Lazy, Stack, Tags, Token } from 'aws-cdk-lib';
import { Rule } from 'aws-cdk-lib/aws-events';
import * as targets from 'aws-cdk-lib/aws-events-targets';
import { LayerVersion, Runtime } from 'aws-cdk-lib/aws-lambda';
import { NodejsFunction, OutputFormat } from 'aws-cdk-lib/aws-lambda-nodejs';
import { Construct } from 'constructs';
import { readFileSync } from 'fs';
import { createRequire } from 'module';
import { fileURLToPath } from 'node:url';
import { EOL } from 'os';
import * as path from 'path';
import { FunctionEnvironmentTranslator } from './function_env_translator.js';
import { FunctionEnvironmentTypeGenerator } from './function_env_type_generator.js';
import { FunctionLayerArnParser } from './layer_parser.js';
import { convertFunctionSchedulesToRuleSchedules } from './schedule_parser.js';
const functionStackType = 'function-Lambda';
/**
 * Entry point for defining a function in the Amplify ecosystem
 */
export const defineFunction = (props = {}) => new FunctionFactory(props, new Error().stack);
/**
 * Create Lambda functions in the context of an Amplify backend definition
 */
class FunctionFactory {
    props;
    callerStack;
    generator;
    /**
     * Create a new AmplifyFunctionFactory
     */
    constructor(props, callerStack) {
        this.props = props;
        this.callerStack = callerStack;
    }
    /**
     * Creates an instance of AmplifyFunction within the provided Amplify context
     */
    getInstance = ({ constructContainer, outputStorageStrategy, resourceNameValidator, }) => {
        if (!this.generator) {
            this.generator = new FunctionGenerator(this.hydrateDefaults(resourceNameValidator), outputStorageStrategy);
        }
        return constructContainer.getOrCompute(this.generator);
    };
    hydrateDefaults = (resourceNameValidator) => {
        const name = this.resolveName();
        resourceNameValidator?.validate(name);
        const parser = new FunctionLayerArnParser();
        const layers = parser.parseLayers(this.props.layers ?? {}, name);
        return {
            name,
            entry: this.resolveEntry(),
            timeoutSeconds: this.resolveTimeout(),
            memoryMB: this.resolveMemory(),
            environment: this.props.environment ?? {},
            runtime: this.resolveRuntime(),
            schedule: this.resolveSchedule(),
            bundling: this.resolveBundling(),
            layers,
        };
    };
    resolveName = () => {
        // If name is set explicitly, use that
        if (this.props.name) {
            return this.props.name;
        }
        // If entry is set, use the basename of the entry path
        if (this.props.entry) {
            return path.parse(this.props.entry).name;
        }
        // Otherwise, use the directory name where the function is defined
        return path.basename(new CallerDirectoryExtractor(this.callerStack).extract());
    };
    resolveEntry = () => {
        // if entry is not set, default to handler.ts
        if (!this.props.entry) {
            return path.join(new CallerDirectoryExtractor(this.callerStack).extract(), 'handler.ts');
        }
        // if entry is absolute use that
        if (path.isAbsolute(this.props.entry)) {
            return this.props.entry;
        }
        // if entry is relative, compute with respect to the caller directory
        return path.join(new CallerDirectoryExtractor(this.callerStack).extract(), this.props.entry);
    };
    resolveTimeout = () => {
        const timeoutMin = 1;
        const timeoutMax = 60 * 15; // 15 minutes in seconds
        const timeoutDefault = 3;
        if (this.props.timeoutSeconds === undefined) {
            return timeoutDefault;
        }
        if (!isWholeNumberBetweenInclusive(this.props.timeoutSeconds, timeoutMin, timeoutMax)) {
            throw new Error(`timeoutSeconds must be a whole number between ${timeoutMin} and ${timeoutMax} inclusive`);
        }
        return this.props.timeoutSeconds;
    };
    resolveMemory = () => {
        const memoryMin = 128;
        const memoryMax = 10240;
        const memoryDefault = 512;
        if (this.props.memoryMB === undefined) {
            return memoryDefault;
        }
        if (!isWholeNumberBetweenInclusive(this.props.memoryMB, memoryMin, memoryMax)) {
            throw new Error(`memoryMB must be a whole number between ${memoryMin} and ${memoryMax} inclusive`);
        }
        return this.props.memoryMB;
    };
    resolveRuntime = () => {
        const runtimeDefault = 18;
        // if runtime is not set, default to the oldest LTS
        if (!this.props.runtime) {
            return runtimeDefault;
        }
        if (!(this.props.runtime in nodeVersionMap)) {
            throw new Error(`runtime must be one of the following: ${Object.keys(nodeVersionMap).join(', ')}`);
        }
        return this.props.runtime;
    };
    resolveSchedule = () => {
        if (!this.props.schedule) {
            return [];
        }
        return this.props.schedule;
    };
    resolveBundling = () => {
        const bundlingDefault = {
            format: OutputFormat.ESM,
            bundleAwsSDK: true,
            loader: {
                '.node': 'file',
            },
            minify: true,
            sourceMap: true,
        };
        return {
            ...bundlingDefault,
            minify: this.resolveMinify(this.props.bundling),
        };
    };
    resolveMinify = (bundling) => {
        return bundling?.minify === undefined ? true : bundling.minify;
    };
}
class FunctionGenerator {
    props;
    outputStorageStrategy;
    resourceGroupName = 'function';
    constructor(props, outputStorageStrategy) {
        this.props = props;
        this.outputStorageStrategy = outputStorageStrategy;
    }
    generateContainerEntry = ({ scope, backendSecretResolver, }) => {
        return new AmplifyFunction(scope, this.props.name, this.props, backendSecretResolver, this.outputStorageStrategy);
    };
}
class AmplifyFunction extends Construct {
    resources;
    stack;
    functionEnvironmentTranslator;
    constructor(scope, id, props, backendSecretResolver, outputStorageStrategy) {
        super(scope, id);
        this.stack = Stack.of(scope);
        // resolve layers to LayerVersion objects for the NodejsFunction constructor using the scope.
        const resolvedLayers = Object.entries(props.layers).map(([key, arn]) => {
            const layerRegion = arn.split(':')[3];
            // If region is an unresolved token, use lazy to get region
            const region = Token.isUnresolved(this.stack.region)
                ? Lazy.string({
                    produce: () => this.stack.region,
                })
                : this.stack.region;
            if (layerRegion !== region) {
                throw new AmplifyUserError('InvalidLayerArnRegionError', {
                    message: `Region in ARN does not match function region for layer: ${key}`,
                    resolution: 'Update the layer ARN with the same region as the function',
                });
            }
            return LayerVersion.fromLayerVersionArn(scope, `${props.name}-${key}-layer`, arn);
        });
        const runtime = nodeVersionMap[props.runtime];
        const require = createRequire(import.meta.url);
        const shims = runtime === Runtime.NODEJS_16_X
            ? []
            : [require.resolve('./lambda-shims/cjs_shim')];
        const ssmResolverFile = runtime === Runtime.NODEJS_16_X
            ? require.resolve('./lambda-shims/resolve_ssm_params_sdk_v2') // use aws cdk v2 in node 16
            : require.resolve('./lambda-shims/resolve_ssm_params');
        const invokeSsmResolverFile = require.resolve('./lambda-shims/invoke_ssm_shim');
        /**
         * This code concatenates the contents of the ssm resolver and invoker into a single line that can be used as the esbuild banner content
         * This banner is responsible for resolving the customer's SSM parameters at runtime
         */
        const bannerCode = readFileSync(ssmResolverFile, 'utf-8')
            .concat(readFileSync(invokeSsmResolverFile, 'utf-8'))
            .split(new RegExp(`${EOL}|\n|\r`, 'g'))
            .map((line) => line.replace(/\/\/.*$/, '')) // strip out inline comments because the banner is going to be flattened into a single line
            .join('');
        const functionEnvironmentTypeGenerator = new FunctionEnvironmentTypeGenerator(id);
        // esbuild runs as part of the NodejsFunction constructor, so we eagerly generate the process env shim without types so it can be included in the function bundle.
        // This will be overwritten with the typed file at the end of synthesis
        functionEnvironmentTypeGenerator.generateProcessEnvShim();
        let functionLambda;
        try {
            functionLambda = new NodejsFunction(scope, `${id}-lambda`, {
                entry: props.entry,
                timeout: Duration.seconds(props.timeoutSeconds),
                memorySize: props.memoryMB,
                runtime: nodeVersionMap[props.runtime],
                layers: resolvedLayers,
                bundling: {
                    ...props.bundling,
                    banner: bannerCode,
                    inject: shims,
                    externalModules: Object.keys(props.layers),
                },
            });
        }
        catch (error) {
            // If the error is from ES Bundler which is executed as a child process by CDK,
            // then the error from CDK contains the command that was executed along with the exit status.
            // Wrapping it here  would cause the cdk_deployer to re-throw this wrapped exception
            // instead of scraping the stderr for actual ESBuild error.
            if (error instanceof Error &&
                error.message.match(/Failed to bundle asset.*exited with status/)) {
                throw error;
            }
            throw new AmplifyUserError('NodeJSFunctionConstructInitializationError', {
                message: 'Failed to instantiate nodejs function construct',
                resolution: 'See the underlying error message for more details. Use `--debug` for additional debugging information.',
            }, error);
        }
        try {
            const schedules = convertFunctionSchedulesToRuleSchedules(functionLambda, props.schedule);
            const lambdaTarget = new targets.LambdaFunction(functionLambda);
            schedules.forEach((schedule, index) => {
                // Lambda name will be prepended to rule id, so only using index here for uniqueness
                const rule = new Rule(functionLambda, `schedule${index}`, {
                    schedule,
                });
                rule.addTarget(lambdaTarget);
            });
        }
        catch (error) {
            throw new AmplifyUserError('FunctionScheduleInitializationError', {
                message: 'Failed to instantiate schedule for nodejs function',
                resolution: 'See the underlying error message for more details.',
            }, error);
        }
        Tags.of(functionLambda).add(TagName.FRIENDLY_NAME, id);
        this.functionEnvironmentTranslator = new FunctionEnvironmentTranslator(functionLambda, props.environment, backendSecretResolver, functionEnvironmentTypeGenerator);
        this.resources = {
            lambda: functionLambda,
            cfnResources: {
                cfnFunction: functionLambda.node.findChild('Resource'),
            },
        };
        this.storeOutput(outputStorageStrategy);
        new AttributionMetadataStorage().storeAttributionMetadata(Stack.of(this), functionStackType, fileURLToPath(new URL('../package.json', import.meta.url)));
    }
    addEnvironment = (key, value) => {
        this.functionEnvironmentTranslator.addEnvironmentEntry(key, value);
    };
    getResourceAccessAcceptor = () => ({
        identifier: `${this.node.id}LambdaResourceAccessAcceptor`,
        acceptResourceAccess: (policy, ssmEnvironmentEntries) => {
            const role = this.resources.lambda.role;
            if (!role) {
                // This should never happen since we are using the Function L2 construct
                throw new Error('No execution role found to attach lambda permissions to');
            }
            policy.attachToRole(role);
            ssmEnvironmentEntries.forEach(({ name, path }) => {
                this.functionEnvironmentTranslator.addSsmEnvironmentEntry(name, path);
            });
        },
    });
    /**
     * Store storage outputs using provided strategy
     */
    storeOutput = (outputStorageStrategy) => {
        outputStorageStrategy.appendToBackendOutputList(functionOutputKey, {
            version: '1',
            payload: {
                definedFunctions: this.resources.lambda.functionName,
            },
        });
    };
}
const isWholeNumberBetweenInclusive = (test, min, max) => min <= test && test <= max && test % 1 === 0;
const nodeVersionMap = {
    16: Runtime.NODEJS_16_X,
    18: Runtime.NODEJS_18_X,
    20: Runtime.NODEJS_20_X,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxpQkFBaUIsR0FDbEIsTUFBTSxxQ0FBcUMsQ0FBQztBQUM3QyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNqRixPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLHdCQUF3QixFQUN4QixPQUFPLEdBQ1IsTUFBTSw0QkFBNEIsQ0FBQztBQWdCcEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDakUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzlDLE9BQU8sS0FBSyxPQUFPLE1BQU0sZ0NBQWdDLENBQUM7QUFFMUQsT0FBTyxFQUFlLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RSxPQUFPLEVBQUUsY0FBYyxFQUFFLFlBQVksRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzdFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdkMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLElBQUksQ0FBQztBQUNsQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDekMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLElBQUksQ0FBQztBQUN6QixPQUFPLEtBQUssSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUM3QixPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNwRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxtQkFB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LFdBQVc7SUFDdkIsRUFBRSxFQUFFLE9BQU8sQ0FBQyxXQUFXO0lBQ3ZCLEVBQUUsRUFBRSxPQUFPLENBQUMsV0FBVztDQUN4QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRnVuY3Rpb25PdXRwdXQsXG4gIGZ1bmN0aW9uT3V0cHV0S2V5LFxufSBmcm9tICdAYXdzLWFtcGxpZnkvYmFja2VuZC1vdXRwdXQtc2NoZW1hcyc7XG5pbXBvcnQgeyBBdHRyaWJ1dGlvbk1ldGFkYXRhU3RvcmFnZSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9iYWNrZW5kLW91dHB1dC1zdG9yYWdlJztcbmltcG9ydCB7XG4gIEFtcGxpZnlVc2VyRXJyb3IsXG4gIENhbGxlckRpcmVjdG9yeUV4dHJhY3RvcixcbiAgVGFnTmFtZSxcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHtcbiAgQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneSxcbiAgQmFja2VuZFNlY3JldCxcbiAgQmFja2VuZFNlY3JldFJlc29sdmVyLFxuICBDb25zdHJ1Y3RDb250YWluZXJFbnRyeUdlbmVyYXRvcixcbiAgQ29uc3RydWN0RmFjdG9yeSxcbiAgQ29uc3RydWN0RmFjdG9yeUdldEluc3RhbmNlUHJvcHMsXG4gIEZ1bmN0aW9uUmVzb3VyY2VzLFxuICBHZW5lcmF0ZUNvbnRhaW5lckVudHJ5UHJvcHMsXG4gIFJlc291cmNlQWNjZXNzQWNjZXB0b3JGYWN0b3J5LFxuICBSZXNvdXJjZU5hbWVWYWxpZGF0b3IsXG4gIFJlc291cmNlUHJvdmlkZXIsXG4gIFNzbUVudmlyb25tZW50RW50cnksXG4gIFN0YWNrUHJvdmlkZXIsXG59IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuaW1wb3J0IHsgRHVyYXRpb24sIExhenksIFN0YWNrLCBUYWdzLCBUb2tlbiB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IFJ1bGUgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZXZlbnRzJztcbmltcG9ydCAqIGFzIHRhcmdldHMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWV2ZW50cy10YXJnZXRzJztcbmltcG9ydCB7IFBvbGljeSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgQ2ZuRnVuY3Rpb24sIExheWVyVmVyc2lvbiwgUnVudGltZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xuaW1wb3J0IHsgTm9kZWpzRnVuY3Rpb24sIE91dHB1dEZvcm1hdCB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEtbm9kZWpzJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgY3JlYXRlUmVxdWlyZSB9IGZyb20gJ21vZHVsZSc7XG5pbXBvcnQgeyBmaWxlVVJMVG9QYXRoIH0gZnJvbSAnbm9kZTp1cmwnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IEZ1bmN0aW9uRW52aXJvbm1lbnRUcmFuc2xhdG9yIH0gZnJvbSAnLi9mdW5jdGlvbl9lbnZfdHJhbnNsYXRvci5qcyc7XG5pbXBvcnQgeyBGdW5jdGlvbkVudmlyb25tZW50VHlwZUdlbmVyYXRvciB9IGZyb20gJy4vZnVuY3Rpb25fZW52X3R5cGVfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IEZ1bmN0aW9uTGF5ZXJBcm5QYXJzZXIgfSBmcm9tICcuL2xheWVyX3BhcnNlci5qcyc7XG5pbXBvcnQgeyBjb252ZXJ0RnVuY3Rpb25TY2hlZHVsZXNUb1J1bGVTY2hlZHVsZXMgfSBmcm9tICcuL3NjaGVkdWxlX3BhcnNlci5qcyc7XG5cbmNvbnN0IGZ1bmN0aW9uU3RhY2tUeXBlID0gJ2Z1bmN0aW9uLUxhbWJkYSc7XG5cbmV4cG9ydCB0eXBlIEFkZEVudmlyb25tZW50RmFjdG9yeSA9IHtcbiAgYWRkRW52aXJvbm1lbnQ6IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IEJhY2tlbmRTZWNyZXQpID0+IHZvaWQ7XG59O1xuXG5leHBvcnQgdHlwZSBDcm9uU2NoZWR1bGUgPVxuICB8IGAke3N0cmluZ30gJHtzdHJpbmd9ICR7c3RyaW5nfSAke3N0cmluZ30gJHtzdHJpbmd9YFxuICB8IGAke3N0cmluZ30gJHtzdHJpbmd9ICR7c3RyaW5nfSAke3N0cmluZ30gJHtzdHJpbmd9ICR7c3RyaW5nfWA7XG5leHBvcnQgdHlwZSBUaW1lSW50ZXJ2YWwgPVxuICB8IGBldmVyeSAke251bWJlcn1tYFxuICB8IGBldmVyeSAke251bWJlcn1oYFxuICB8IGBldmVyeSBkYXlgXG4gIHwgYGV2ZXJ5IHdlZWtgXG4gIHwgYGV2ZXJ5IG1vbnRoYFxuICB8IGBldmVyeSB5ZWFyYDtcbmV4cG9ydCB0eXBlIEZ1bmN0aW9uU2NoZWR1bGUgPSBUaW1lSW50ZXJ2YWwgfCBDcm9uU2NoZWR1bGU7XG5cbi8qKlxuICogRW50cnkgcG9pbnQgZm9yIGRlZmluaW5nIGEgZnVuY3Rpb24gaW4gdGhlIEFtcGxpZnkgZWNvc3lzdGVtXG4gKi9cbmV4cG9ydCBjb25zdCBkZWZpbmVGdW5jdGlvbiA9IChcbiAgcHJvcHM6IEZ1bmN0aW9uUHJvcHMgPSB7fVxuKTogQ29uc3RydWN0RmFjdG9yeTxcbiAgUmVzb3VyY2VQcm92aWRlcjxGdW5jdGlvblJlc291cmNlcz4gJlxuICAgIFJlc291cmNlQWNjZXNzQWNjZXB0b3JGYWN0b3J5ICZcbiAgICBBZGRFbnZpcm9ubWVudEZhY3RvcnkgJlxuICAgIFN0YWNrUHJvdmlkZXJcbj4gPT4gbmV3IEZ1bmN0aW9uRmFjdG9yeShwcm9wcywgbmV3IEVycm9yKCkuc3RhY2spO1xuXG5leHBvcnQgdHlwZSBGdW5jdGlvblByb3BzID0ge1xuICAvKipcbiAgICogQSBuYW1lIGZvciB0aGUgZnVuY3Rpb24uXG4gICAqIERlZmF1bHRzIHRvIHRoZSBiYXNlbmFtZSBvZiB0aGUgZW50cnkgcGF0aCBpZiBzcGVjaWZpZWQuXG4gICAqIElmIG5vIGVudHJ5IGlzIHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdGhlIGRpcmVjdG9yeSBuYW1lIGluIHdoaWNoIHRoaXMgZnVuY3Rpb24gaXMgZGVmaW5lZC5cbiAgICpcbiAgICogRXhhbXBsZTpcbiAgICogSWYgZW50cnkgaXMgYC4vc2NoZWR1bGVkLWRiLWJhY2t1cC50c2AgdGhlIG5hbWUgd2lsbCBkZWZhdWx0IHRvIFwic2NoZWR1bGVkLWRiLWJhY2t1cFwiXG4gICAqIElmIGVudHJ5IGlzIG5vdCBzZXQgYW5kIHRoZSBmdW5jdGlvbiBpcyBkZWZpbmVkIGluIGBhbXBsaWZ5L2Z1bmN0aW9ucy9kYi1iYWNrdXAvcmVzb3VyY2UudHNgIHRoZSBuYW1lIHdpbGwgZGVmYXVsdCB0byBcImRiLWJhY2t1cFwiXG4gICAqL1xuICBuYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHBhdGggdG8gdGhlIGZpbGUgdGhhdCBjb250YWlucyB0aGUgZnVuY3Rpb24gZW50cnkgcG9pbnQuXG4gICAqIElmIHRoaXMgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCBpcyBjb21wdXRlZCByZWxhdGl2ZSB0byB0aGUgZmlsZSB3aGVyZSB0aGlzIGZ1bmN0aW9uIGlzIGRlZmluZWRcbiAgICpcbiAgICogRGVmYXVsdHMgdG8gJy4vaGFuZGxlci50cydcbiAgICovXG4gIGVudHJ5Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBhbW91bnQgb2YgdGltZSBpbiBzZWNvbmRzIGJldHdlZW4gMSBzZWNvbmQgYW5kIDE1IG1pbnV0ZXMuXG4gICAqIE11c3QgYmUgYSB3aG9sZSBudW1iZXIuXG4gICAqIERlZmF1bHQgaXMgMyBzZWNvbmRzLlxuICAgKi9cbiAgdGltZW91dFNlY29uZHM/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIEFuIGFtb3VudCBvZiBtZW1vcnkgKFJBTSkgdG8gYWxsb2NhdGUgdG8gdGhlIGZ1bmN0aW9uIGJldHdlZW4gMTI4IGFuZCAxMDI0MCBNQi5cbiAgICogTXVzdCBiZSBhIHdob2xlIG51bWJlci5cbiAgICogRGVmYXVsdCBpcyA1MTJNQi5cbiAgICovXG4gIG1lbW9yeU1CPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBFbnZpcm9ubWVudCB2YXJpYWJsZXMgdGhhdCB3aWxsIGJlIGF2YWlsYWJsZSBkdXJpbmcgZnVuY3Rpb24gZXhlY3V0aW9uXG4gICAqL1xuICBlbnZpcm9ubWVudD86IFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IEJhY2tlbmRTZWNyZXQ+O1xuXG4gIC8qKlxuICAgKiBOb2RlIHJ1bnRpbWUgdmVyc2lvbiBmb3IgdGhlIGxhbWJkYSBlbnZpcm9ubWVudC5cbiAgICpcbiAgICogRGVmYXVsdHMgdG8gdGhlIG9sZGVzdCBOb2RlSlMgTFRTIHZlcnNpb24uIFNlZSBodHRwczovL25vZGVqcy5vcmcvZW4vYWJvdXQvcHJldmlvdXMtcmVsZWFzZXNcbiAgICovXG4gIHJ1bnRpbWU/OiBOb2RlVmVyc2lvbjtcblxuICAvKipcbiAgICogQSB0aW1lIGludGVydmFsIHN0cmluZyB0byBwZXJpb2RpY2FsbHkgcnVuIHRoZSBmdW5jdGlvbi5cbiAgICogVGhpcyBjYW4gYmUgZWl0aGVyIGEgc3RyaW5nIG9mIGBcImV2ZXJ5IDxwb3NpdGl2ZSB3aG9sZSBudW1iZXI+PG0gKG1pbnV0ZSkgb3IgaCAoaG91cik+XCJgLCBgXCJldmVyeSBkYXl8d2Vla3xtb250aHx5ZWFyXCJgIG9yIGNyb24gZXhwcmVzc2lvbi5cbiAgICogRGVmYXVsdHMgdG8gbm8gc2NoZWR1bGluZyBmb3IgdGhlIGZ1bmN0aW9uLlxuICAgKiBAZXhhbXBsZVxuICAgKiBzY2hlZHVsZTogXCJldmVyeSA1bVwiXG4gICAqIEBleGFtcGxlXG4gICAqIHNjaGVkdWxlOiBcImV2ZXJ5IHdlZWtcIlxuICAgKiBAZXhhbXBsZVxuICAgKiBzY2hlZHVsZTogXCIwIDkgPyAqIDIgKlwiIC8vIGV2ZXJ5IE1vbmRheSBhdCA5YW1cbiAgICovXG4gIHNjaGVkdWxlPzogRnVuY3Rpb25TY2hlZHVsZSB8IEZ1bmN0aW9uU2NoZWR1bGVbXTtcblxuICAvKipcbiAgICogQXR0YWNoIExhbWJkYSBsYXllcnMgdG8gYSBmdW5jdGlvblxuICAgKiAtIEEgTGFtYmRhIGxheWVyIGlzIHJlcHJlc2VudGVkIGJ5IGFuIG9iamVjdCBvZiBrZXkvdmFsdWUgcGFpciB3aGVyZSB0aGUga2V5IGlzIHRoZSBtb2R1bGUgbmFtZSB0aGF0IGlzIGV4cG9ydGVkIGZyb20geW91ciBsYXllciBhbmQgdGhlIHZhbHVlIGlzIHRoZSBBUk4gb2YgdGhlIGxheWVyLiBUaGUga2V5IChtb2R1bGUgbmFtZSkgaXMgdXNlZCB0byBleHRlcm5hbGl6ZSB0aGUgbW9kdWxlIGRlcGVuZGVuY3kgc28gaXQgZG9lc24ndCBnZXQgYnVuZGxlZCB3aXRoIHlvdXIgbGFtYmRhIGZ1bmN0aW9uXG4gICAqIC0gTWF4aW11bSBvZiA1IGxheWVycyBjYW4gYmUgYXR0YWNoZWQgdG8gYSBmdW5jdGlvbiBhbmQgbXVzdCBiZSBpbiB0aGUgc2FtZSByZWdpb24gYXMgdGhlIGZ1bmN0aW9uLlxuICAgKiBAZXhhbXBsZVxuICAgKiBsYXllcnM6IHtcbiAgICogICAgXCJAYXdzLWxhbWJkYS1wb3dlcnRvb2xzL2xvZ2dlclwiOiBcImFybjphd3M6bGFtYmRhOjxjdXJyZW50LXJlZ2lvbj46MDk0Mjc0MTA1OTE1OmxheWVyOkFXU0xhbWJkYVBvd2VydG9vbHNUeXBlU2NyaXB0VjI6MTFcIlxuICAgKiB9LFxuICAgKiBAc2VlIFtBbXBsaWZ5IGRvY3VtZW50YXRpb24gZm9yIExhbWJkYSBsYXllcnNdKGh0dHBzOi8vZG9jcy5hbXBsaWZ5LmF3cy9yZWFjdC9idWlsZC1hLWJhY2tlbmQvZnVuY3Rpb25zL2FkZC1sYW1iZGEtbGF5ZXJzKVxuICAgKiBAc2VlIFtBV1MgZG9jdW1lbnRhdGlvbiBmb3IgTGFtYmRhIGxheWVyc10oaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2xhbWJkYS9sYXRlc3QvZGcvY2hhcHRlci1sYXllcnMuaHRtbClcbiAgICovXG4gIGxheWVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG5cbiAgLypcbiAgICogT3B0aW9ucyBmb3IgYnVuZGxpbmcgdGhlIGZ1bmN0aW9uIGNvZGUuXG4gICAqL1xuICBidW5kbGluZz86IEZ1bmN0aW9uQnVuZGxpbmdPcHRpb25zO1xufTtcblxuZXhwb3J0IHR5cGUgRnVuY3Rpb25CdW5kbGluZ09wdGlvbnMgPSB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIG1pbmlmeSB0aGUgZnVuY3Rpb24gY29kZS5cbiAgICpcbiAgICogRGVmYXVsdHMgdG8gdHJ1ZS5cbiAgICovXG4gIG1pbmlmeT86IGJvb2xlYW47XG59O1xuXG4vKipcbiAqIENyZWF0ZSBMYW1iZGEgZnVuY3Rpb25zIGluIHRoZSBjb250ZXh0IG9mIGFuIEFtcGxpZnkgYmFja2VuZCBkZWZpbml0aW9uXG4gKi9cbmNsYXNzIEZ1bmN0aW9uRmFjdG9yeSBpbXBsZW1lbnRzIENvbnN0cnVjdEZhY3Rvcnk8QW1wbGlmeUZ1bmN0aW9uPiB7XG4gIHByaXZhdGUgZ2VuZXJhdG9yOiBDb25zdHJ1Y3RDb250YWluZXJFbnRyeUdlbmVyYXRvcjtcbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBBbXBsaWZ5RnVuY3Rpb25GYWN0b3J5XG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb3BzOiBGdW5jdGlvblByb3BzLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY2FsbGVyU3RhY2s/OiBzdHJpbmdcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEFtcGxpZnlGdW5jdGlvbiB3aXRoaW4gdGhlIHByb3ZpZGVkIEFtcGxpZnkgY29udGV4dFxuICAgKi9cbiAgZ2V0SW5zdGFuY2UgPSAoe1xuICAgIGNvbnN0cnVjdENvbnRhaW5lcixcbiAgICBvdXRwdXRTdG9yYWdlU3RyYXRlZ3ksXG4gICAgcmVzb3VyY2VOYW1lVmFsaWRhdG9yLFxuICB9OiBDb25zdHJ1Y3RGYWN0b3J5R2V0SW5zdGFuY2VQcm9wcyk6IEFtcGxpZnlGdW5jdGlvbiA9PiB7XG4gICAgaWYgKCF0aGlzLmdlbmVyYXRvcikge1xuICAgICAgdGhpcy5nZW5lcmF0b3IgPSBuZXcgRnVuY3Rpb25HZW5lcmF0b3IoXG4gICAgICAgIHRoaXMuaHlkcmF0ZURlZmF1bHRzKHJlc291cmNlTmFtZVZhbGlkYXRvciksXG4gICAgICAgIG91dHB1dFN0b3JhZ2VTdHJhdGVneVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnN0cnVjdENvbnRhaW5lci5nZXRPckNvbXB1dGUodGhpcy5nZW5lcmF0b3IpIGFzIEFtcGxpZnlGdW5jdGlvbjtcbiAgfTtcblxuICBwcml2YXRlIGh5ZHJhdGVEZWZhdWx0cyA9IChcbiAgICByZXNvdXJjZU5hbWVWYWxpZGF0b3I/OiBSZXNvdXJjZU5hbWVWYWxpZGF0b3JcbiAgKTogSHlkcmF0ZWRGdW5jdGlvblByb3BzID0+IHtcbiAgICBjb25zdCBuYW1lID0gdGhpcy5yZXNvbHZlTmFtZSgpO1xuICAgIHJlc291cmNlTmFtZVZhbGlkYXRvcj8udmFsaWRhdGUobmFtZSk7XG4gICAgY29uc3QgcGFyc2VyID0gbmV3IEZ1bmN0aW9uTGF5ZXJBcm5QYXJzZXIoKTtcbiAgICBjb25zdCBsYXllcnMgPSBwYXJzZXIucGFyc2VMYXllcnModGhpcy5wcm9wcy5sYXllcnMgPz8ge30sIG5hbWUpO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lLFxuICAgICAgZW50cnk6IHRoaXMucmVzb2x2ZUVudHJ5KCksXG4gICAgICB0aW1lb3V0U2Vjb25kczogdGhpcy5yZXNvbHZlVGltZW91dCgpLFxuICAgICAgbWVtb3J5TUI6IHRoaXMucmVzb2x2ZU1lbW9yeSgpLFxuICAgICAgZW52aXJvbm1lbnQ6IHRoaXMucHJvcHMuZW52aXJvbm1lbnQgPz8ge30sXG4gICAgICBydW50aW1lOiB0aGlzLnJlc29sdmVSdW50aW1lKCksXG4gICAgICBzY2hlZHVsZTogdGhpcy5yZXNvbHZlU2NoZWR1bGUoKSxcbiAgICAgIGJ1bmRsaW5nOiB0aGlzLnJlc29sdmVCdW5kbGluZygpLFxuICAgICAgbGF5ZXJzLFxuICAgIH07XG4gIH07XG5cbiAgcHJpdmF0ZSByZXNvbHZlTmFtZSA9ICgpID0+IHtcbiAgICAvLyBJZiBuYW1lIGlzIHNldCBleHBsaWNpdGx5LCB1c2UgdGhhdFxuICAgIGlmICh0aGlzLnByb3BzLm5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLm5hbWU7XG4gICAgfVxuICAgIC8vIElmIGVudHJ5IGlzIHNldCwgdXNlIHRoZSBiYXNlbmFtZSBvZiB0aGUgZW50cnkgcGF0aFxuICAgIGlmICh0aGlzLnByb3BzLmVudHJ5KSB7XG4gICAgICByZXR1cm4gcGF0aC5wYXJzZSh0aGlzLnByb3BzLmVudHJ5KS5uYW1lO1xuICAgIH1cblxuICAgIC8vIE90aGVyd2lzZSwgdXNlIHRoZSBkaXJlY3RvcnkgbmFtZSB3aGVyZSB0aGUgZnVuY3Rpb24gaXMgZGVmaW5lZFxuICAgIHJldHVybiBwYXRoLmJhc2VuYW1lKFxuICAgICAgbmV3IENhbGxlckRpcmVjdG9yeUV4dHJhY3Rvcih0aGlzLmNhbGxlclN0YWNrKS5leHRyYWN0KClcbiAgICApO1xuICB9O1xuXG4gIHByaXZhdGUgcmVzb2x2ZUVudHJ5ID0gKCkgPT4ge1xuICAgIC8vIGlmIGVudHJ5IGlzIG5vdCBzZXQsIGRlZmF1bHQgdG8gaGFuZGxlci50c1xuICAgIGlmICghdGhpcy5wcm9wcy5lbnRyeSkge1xuICAgICAgcmV0dXJuIHBhdGguam9pbihcbiAgICAgICAgbmV3IENhbGxlckRpcmVjdG9yeUV4dHJhY3Rvcih0aGlzLmNhbGxlclN0YWNrKS5leHRyYWN0KCksXG4gICAgICAgICdoYW5kbGVyLnRzJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBpZiBlbnRyeSBpcyBhYnNvbHV0ZSB1c2UgdGhhdFxuICAgIGlmIChwYXRoLmlzQWJzb2x1dGUodGhpcy5wcm9wcy5lbnRyeSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLmVudHJ5O1xuICAgIH1cblxuICAgIC8vIGlmIGVudHJ5IGlzIHJlbGF0aXZlLCBjb21wdXRlIHdpdGggcmVzcGVjdCB0byB0aGUgY2FsbGVyIGRpcmVjdG9yeVxuICAgIHJldHVybiBwYXRoLmpvaW4oXG4gICAgICBuZXcgQ2FsbGVyRGlyZWN0b3J5RXh0cmFjdG9yKHRoaXMuY2FsbGVyU3RhY2spLmV4dHJhY3QoKSxcbiAgICAgIHRoaXMucHJvcHMuZW50cnlcbiAgICApO1xuICB9O1xuXG4gIHByaXZhdGUgcmVzb2x2ZVRpbWVvdXQgPSAoKSA9PiB7XG4gICAgY29uc3QgdGltZW91dE1pbiA9IDE7XG4gICAgY29uc3QgdGltZW91dE1heCA9IDYwICogMTU7IC8vIDE1IG1pbnV0ZXMgaW4gc2Vjb25kc1xuICAgIGNvbnN0IHRpbWVvdXREZWZhdWx0ID0gMztcbiAgICBpZiAodGhpcy5wcm9wcy50aW1lb3V0U2Vjb25kcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdGltZW91dERlZmF1bHQ7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgIWlzV2hvbGVOdW1iZXJCZXR3ZWVuSW5jbHVzaXZlKFxuICAgICAgICB0aGlzLnByb3BzLnRpbWVvdXRTZWNvbmRzLFxuICAgICAgICB0aW1lb3V0TWluLFxuICAgICAgICB0aW1lb3V0TWF4XG4gICAgICApXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGB0aW1lb3V0U2Vjb25kcyBtdXN0IGJlIGEgd2hvbGUgbnVtYmVyIGJldHdlZW4gJHt0aW1lb3V0TWlufSBhbmQgJHt0aW1lb3V0TWF4fSBpbmNsdXNpdmVgXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5wcm9wcy50aW1lb3V0U2Vjb25kcztcbiAgfTtcblxuICBwcml2YXRlIHJlc29sdmVNZW1vcnkgPSAoKSA9PiB7XG4gICAgY29uc3QgbWVtb3J5TWluID0gMTI4O1xuICAgIGNvbnN0IG1lbW9yeU1heCA9IDEwMjQwO1xuICAgIGNvbnN0IG1lbW9yeURlZmF1bHQgPSA1MTI7XG4gICAgaWYgKHRoaXMucHJvcHMubWVtb3J5TUIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG1lbW9yeURlZmF1bHQ7XG4gICAgfVxuICAgIGlmIChcbiAgICAgICFpc1dob2xlTnVtYmVyQmV0d2VlbkluY2x1c2l2ZSh0aGlzLnByb3BzLm1lbW9yeU1CLCBtZW1vcnlNaW4sIG1lbW9yeU1heClcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYG1lbW9yeU1CIG11c3QgYmUgYSB3aG9sZSBudW1iZXIgYmV0d2VlbiAke21lbW9yeU1pbn0gYW5kICR7bWVtb3J5TWF4fSBpbmNsdXNpdmVgXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5wcm9wcy5tZW1vcnlNQjtcbiAgfTtcblxuICBwcml2YXRlIHJlc29sdmVSdW50aW1lID0gKCkgPT4ge1xuICAgIGNvbnN0IHJ1bnRpbWVEZWZhdWx0ID0gMTg7XG5cbiAgICAvLyBpZiBydW50aW1lIGlzIG5vdCBzZXQsIGRlZmF1bHQgdG8gdGhlIG9sZGVzdCBMVFNcbiAgICBpZiAoIXRoaXMucHJvcHMucnVudGltZSkge1xuICAgICAgcmV0dXJuIHJ1bnRpbWVEZWZhdWx0O1xuICAgIH1cblxuICAgIGlmICghKHRoaXMucHJvcHMucnVudGltZSBpbiBub2RlVmVyc2lvbk1hcCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYHJ1bnRpbWUgbXVzdCBiZSBvbmUgb2YgdGhlIGZvbGxvd2luZzogJHtPYmplY3Qua2V5cyhcbiAgICAgICAgICBub2RlVmVyc2lvbk1hcFxuICAgICAgICApLmpvaW4oJywgJyl9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wcm9wcy5ydW50aW1lO1xuICB9O1xuXG4gIHByaXZhdGUgcmVzb2x2ZVNjaGVkdWxlID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5wcm9wcy5zY2hlZHVsZSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnByb3BzLnNjaGVkdWxlO1xuICB9O1xuXG4gIHByaXZhdGUgcmVzb2x2ZUJ1bmRsaW5nID0gKCkgPT4ge1xuICAgIGNvbnN0IGJ1bmRsaW5nRGVmYXVsdCA9IHtcbiAgICAgIGZvcm1hdDogT3V0cHV0Rm9ybWF0LkVTTSxcbiAgICAgIGJ1bmRsZUF3c1NESzogdHJ1ZSxcbiAgICAgIGxvYWRlcjoge1xuICAgICAgICAnLm5vZGUnOiAnZmlsZScsXG4gICAgICB9LFxuICAgICAgbWluaWZ5OiB0cnVlLFxuICAgICAgc291cmNlTWFwOiB0cnVlLFxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uYnVuZGxpbmdEZWZhdWx0LFxuICAgICAgbWluaWZ5OiB0aGlzLnJlc29sdmVNaW5pZnkodGhpcy5wcm9wcy5idW5kbGluZyksXG4gICAgfTtcbiAgfTtcblxuICBwcml2YXRlIHJlc29sdmVNaW5pZnkgPSAoYnVuZGxpbmc/OiBGdW5jdGlvbkJ1bmRsaW5nT3B0aW9ucykgPT4ge1xuICAgIHJldHVybiBidW5kbGluZz8ubWluaWZ5ID09PSB1bmRlZmluZWQgPyB0cnVlIDogYnVuZGxpbmcubWluaWZ5O1xuICB9O1xufVxuXG50eXBlIEh5ZHJhdGVkRnVuY3Rpb25Qcm9wcyA9IFJlcXVpcmVkPEZ1bmN0aW9uUHJvcHM+O1xuXG5jbGFzcyBGdW5jdGlvbkdlbmVyYXRvciBpbXBsZW1lbnRzIENvbnN0cnVjdENvbnRhaW5lckVudHJ5R2VuZXJhdG9yIHtcbiAgcmVhZG9ubHkgcmVzb3VyY2VHcm91cE5hbWUgPSAnZnVuY3Rpb24nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJvcHM6IEh5ZHJhdGVkRnVuY3Rpb25Qcm9wcyxcbiAgICBwcml2YXRlIHJlYWRvbmx5IG91dHB1dFN0b3JhZ2VTdHJhdGVneTogQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneTxGdW5jdGlvbk91dHB1dD5cbiAgKSB7fVxuXG4gIGdlbmVyYXRlQ29udGFpbmVyRW50cnkgPSAoe1xuICAgIHNjb3BlLFxuICAgIGJhY2tlbmRTZWNyZXRSZXNvbHZlcixcbiAgfTogR2VuZXJhdGVDb250YWluZXJFbnRyeVByb3BzKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBBbXBsaWZ5RnVuY3Rpb24oXG4gICAgICBzY29wZSxcbiAgICAgIHRoaXMucHJvcHMubmFtZSxcbiAgICAgIHRoaXMucHJvcHMsXG4gICAgICBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIsXG4gICAgICB0aGlzLm91dHB1dFN0b3JhZ2VTdHJhdGVneVxuICAgICk7XG4gIH07XG59XG5cbmNsYXNzIEFtcGxpZnlGdW5jdGlvblxuICBleHRlbmRzIENvbnN0cnVjdFxuICBpbXBsZW1lbnRzXG4gICAgUmVzb3VyY2VQcm92aWRlcjxGdW5jdGlvblJlc291cmNlcz4sXG4gICAgUmVzb3VyY2VBY2Nlc3NBY2NlcHRvckZhY3RvcnksXG4gICAgQWRkRW52aXJvbm1lbnRGYWN0b3J5XG57XG4gIHJlYWRvbmx5IHJlc291cmNlczogRnVuY3Rpb25SZXNvdXJjZXM7XG4gIHJlYWRvbmx5IHN0YWNrOiBTdGFjaztcbiAgcHJpdmF0ZSByZWFkb25seSBmdW5jdGlvbkVudmlyb25tZW50VHJhbnNsYXRvcjogRnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3I7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBwcm9wczogSHlkcmF0ZWRGdW5jdGlvblByb3BzLFxuICAgIGJhY2tlbmRTZWNyZXRSZXNvbHZlcjogQmFja2VuZFNlY3JldFJlc29sdmVyLFxuICAgIG91dHB1dFN0b3JhZ2VTdHJhdGVneTogQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneTxGdW5jdGlvbk91dHB1dD5cbiAgKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIHRoaXMuc3RhY2sgPSBTdGFjay5vZihzY29wZSk7XG5cbiAgICAvLyByZXNvbHZlIGxheWVycyB0byBMYXllclZlcnNpb24gb2JqZWN0cyBmb3IgdGhlIE5vZGVqc0Z1bmN0aW9uIGNvbnN0cnVjdG9yIHVzaW5nIHRoZSBzY29wZS5cbiAgICBjb25zdCByZXNvbHZlZExheWVycyA9IE9iamVjdC5lbnRyaWVzKHByb3BzLmxheWVycykubWFwKChba2V5LCBhcm5dKSA9PiB7XG4gICAgICBjb25zdCBsYXllclJlZ2lvbiA9IGFybi5zcGxpdCgnOicpWzNdO1xuICAgICAgLy8gSWYgcmVnaW9uIGlzIGFuIHVucmVzb2x2ZWQgdG9rZW4sIHVzZSBsYXp5IHRvIGdldCByZWdpb25cbiAgICAgIGNvbnN0IHJlZ2lvbiA9IFRva2VuLmlzVW5yZXNvbHZlZCh0aGlzLnN0YWNrLnJlZ2lvbilcbiAgICAgICAgPyBMYXp5LnN0cmluZyh7XG4gICAgICAgICAgICBwcm9kdWNlOiAoKSA9PiB0aGlzLnN0YWNrLnJlZ2lvbixcbiAgICAgICAgICB9KVxuICAgICAgICA6IHRoaXMuc3RhY2sucmVnaW9uO1xuXG4gICAgICBpZiAobGF5ZXJSZWdpb24gIT09IHJlZ2lvbikge1xuICAgICAgICB0aHJvdyBuZXcgQW1wbGlmeVVzZXJFcnJvcignSW52YWxpZExheWVyQXJuUmVnaW9uRXJyb3InLCB7XG4gICAgICAgICAgbWVzc2FnZTogYFJlZ2lvbiBpbiBBUk4gZG9lcyBub3QgbWF0Y2ggZnVuY3Rpb24gcmVnaW9uIGZvciBsYXllcjogJHtrZXl9YCxcbiAgICAgICAgICByZXNvbHV0aW9uOlxuICAgICAgICAgICAgJ1VwZGF0ZSB0aGUgbGF5ZXIgQVJOIHdpdGggdGhlIHNhbWUgcmVnaW9uIGFzIHRoZSBmdW5jdGlvbicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTGF5ZXJWZXJzaW9uLmZyb21MYXllclZlcnNpb25Bcm4oXG4gICAgICAgIHNjb3BlLFxuICAgICAgICBgJHtwcm9wcy5uYW1lfS0ke2tleX0tbGF5ZXJgLFxuICAgICAgICBhcm5cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBydW50aW1lID0gbm9kZVZlcnNpb25NYXBbcHJvcHMucnVudGltZV07XG5cbiAgICBjb25zdCByZXF1aXJlID0gY3JlYXRlUmVxdWlyZShpbXBvcnQubWV0YS51cmwpO1xuXG4gICAgY29uc3Qgc2hpbXMgPVxuICAgICAgcnVudGltZSA9PT0gUnVudGltZS5OT0RFSlNfMTZfWFxuICAgICAgICA/IFtdXG4gICAgICAgIDogW3JlcXVpcmUucmVzb2x2ZSgnLi9sYW1iZGEtc2hpbXMvY2pzX3NoaW0nKV07XG5cbiAgICBjb25zdCBzc21SZXNvbHZlckZpbGUgPVxuICAgICAgcnVudGltZSA9PT0gUnVudGltZS5OT0RFSlNfMTZfWFxuICAgICAgICA/IHJlcXVpcmUucmVzb2x2ZSgnLi9sYW1iZGEtc2hpbXMvcmVzb2x2ZV9zc21fcGFyYW1zX3Nka192MicpIC8vIHVzZSBhd3MgY2RrIHYyIGluIG5vZGUgMTZcbiAgICAgICAgOiByZXF1aXJlLnJlc29sdmUoJy4vbGFtYmRhLXNoaW1zL3Jlc29sdmVfc3NtX3BhcmFtcycpO1xuXG4gICAgY29uc3QgaW52b2tlU3NtUmVzb2x2ZXJGaWxlID0gcmVxdWlyZS5yZXNvbHZlKFxuICAgICAgJy4vbGFtYmRhLXNoaW1zL2ludm9rZV9zc21fc2hpbSdcbiAgICApO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBjb2RlIGNvbmNhdGVuYXRlcyB0aGUgY29udGVudHMgb2YgdGhlIHNzbSByZXNvbHZlciBhbmQgaW52b2tlciBpbnRvIGEgc2luZ2xlIGxpbmUgdGhhdCBjYW4gYmUgdXNlZCBhcyB0aGUgZXNidWlsZCBiYW5uZXIgY29udGVudFxuICAgICAqIFRoaXMgYmFubmVyIGlzIHJlc3BvbnNpYmxlIGZvciByZXNvbHZpbmcgdGhlIGN1c3RvbWVyJ3MgU1NNIHBhcmFtZXRlcnMgYXQgcnVudGltZVxuICAgICAqL1xuICAgIGNvbnN0IGJhbm5lckNvZGUgPSByZWFkRmlsZVN5bmMoc3NtUmVzb2x2ZXJGaWxlLCAndXRmLTgnKVxuICAgICAgLmNvbmNhdChyZWFkRmlsZVN5bmMoaW52b2tlU3NtUmVzb2x2ZXJGaWxlLCAndXRmLTgnKSlcbiAgICAgIC5zcGxpdChuZXcgUmVnRXhwKGAke0VPTH18XFxufFxccmAsICdnJykpXG4gICAgICAubWFwKChsaW5lKSA9PiBsaW5lLnJlcGxhY2UoL1xcL1xcLy4qJC8sICcnKSkgLy8gc3RyaXAgb3V0IGlubGluZSBjb21tZW50cyBiZWNhdXNlIHRoZSBiYW5uZXIgaXMgZ29pbmcgdG8gYmUgZmxhdHRlbmVkIGludG8gYSBzaW5nbGUgbGluZVxuICAgICAgLmpvaW4oJycpO1xuXG4gICAgY29uc3QgZnVuY3Rpb25FbnZpcm9ubWVudFR5cGVHZW5lcmF0b3IgPVxuICAgICAgbmV3IEZ1bmN0aW9uRW52aXJvbm1lbnRUeXBlR2VuZXJhdG9yKGlkKTtcblxuICAgIC8vIGVzYnVpbGQgcnVucyBhcyBwYXJ0IG9mIHRoZSBOb2RlanNGdW5jdGlvbiBjb25zdHJ1Y3Rvciwgc28gd2UgZWFnZXJseSBnZW5lcmF0ZSB0aGUgcHJvY2VzcyBlbnYgc2hpbSB3aXRob3V0IHR5cGVzIHNvIGl0IGNhbiBiZSBpbmNsdWRlZCBpbiB0aGUgZnVuY3Rpb24gYnVuZGxlLlxuICAgIC8vIFRoaXMgd2lsbCBiZSBvdmVyd3JpdHRlbiB3aXRoIHRoZSB0eXBlZCBmaWxlIGF0IHRoZSBlbmQgb2Ygc3ludGhlc2lzXG4gICAgZnVuY3Rpb25FbnZpcm9ubWVudFR5cGVHZW5lcmF0b3IuZ2VuZXJhdGVQcm9jZXNzRW52U2hpbSgpO1xuXG4gICAgbGV0IGZ1bmN0aW9uTGFtYmRhOiBOb2RlanNGdW5jdGlvbjtcbiAgICB0cnkge1xuICAgICAgZnVuY3Rpb25MYW1iZGEgPSBuZXcgTm9kZWpzRnVuY3Rpb24oc2NvcGUsIGAke2lkfS1sYW1iZGFgLCB7XG4gICAgICAgIGVudHJ5OiBwcm9wcy5lbnRyeSxcbiAgICAgICAgdGltZW91dDogRHVyYXRpb24uc2Vjb25kcyhwcm9wcy50aW1lb3V0U2Vjb25kcyksXG4gICAgICAgIG1lbW9yeVNpemU6IHByb3BzLm1lbW9yeU1CLFxuICAgICAgICBydW50aW1lOiBub2RlVmVyc2lvbk1hcFtwcm9wcy5ydW50aW1lXSxcbiAgICAgICAgbGF5ZXJzOiByZXNvbHZlZExheWVycyxcbiAgICAgICAgYnVuZGxpbmc6IHtcbiAgICAgICAgICAuLi5wcm9wcy5idW5kbGluZyxcbiAgICAgICAgICBiYW5uZXI6IGJhbm5lckNvZGUsXG4gICAgICAgICAgaW5qZWN0OiBzaGltcyxcbiAgICAgICAgICBleHRlcm5hbE1vZHVsZXM6IE9iamVjdC5rZXlzKHByb3BzLmxheWVycyksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWYgdGhlIGVycm9yIGlzIGZyb20gRVMgQnVuZGxlciB3aGljaCBpcyBleGVjdXRlZCBhcyBhIGNoaWxkIHByb2Nlc3MgYnkgQ0RLLFxuICAgICAgLy8gdGhlbiB0aGUgZXJyb3IgZnJvbSBDREsgY29udGFpbnMgdGhlIGNvbW1hbmQgdGhhdCB3YXMgZXhlY3V0ZWQgYWxvbmcgd2l0aCB0aGUgZXhpdCBzdGF0dXMuXG4gICAgICAvLyBXcmFwcGluZyBpdCBoZXJlICB3b3VsZCBjYXVzZSB0aGUgY2RrX2RlcGxveWVyIHRvIHJlLXRocm93IHRoaXMgd3JhcHBlZCBleGNlcHRpb25cbiAgICAgIC8vIGluc3RlYWQgb2Ygc2NyYXBpbmcgdGhlIHN0ZGVyciBmb3IgYWN0dWFsIEVTQnVpbGQgZXJyb3IuXG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgJiZcbiAgICAgICAgZXJyb3IubWVzc2FnZS5tYXRjaCgvRmFpbGVkIHRvIGJ1bmRsZSBhc3NldC4qZXhpdGVkIHdpdGggc3RhdHVzLylcbiAgICAgICkge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKFxuICAgICAgICAnTm9kZUpTRnVuY3Rpb25Db25zdHJ1Y3RJbml0aWFsaXphdGlvbkVycm9yJyxcbiAgICAgICAge1xuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gaW5zdGFudGlhdGUgbm9kZWpzIGZ1bmN0aW9uIGNvbnN0cnVjdCcsXG4gICAgICAgICAgcmVzb2x1dGlvbjpcbiAgICAgICAgICAgICdTZWUgdGhlIHVuZGVybHlpbmcgZXJyb3IgbWVzc2FnZSBmb3IgbW9yZSBkZXRhaWxzLiBVc2UgYC0tZGVidWdgIGZvciBhZGRpdGlvbmFsIGRlYnVnZ2luZyBpbmZvcm1hdGlvbi4nLFxuICAgICAgICB9LFxuICAgICAgICBlcnJvciBhcyBFcnJvclxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2NoZWR1bGVzID0gY29udmVydEZ1bmN0aW9uU2NoZWR1bGVzVG9SdWxlU2NoZWR1bGVzKFxuICAgICAgICBmdW5jdGlvbkxhbWJkYSxcbiAgICAgICAgcHJvcHMuc2NoZWR1bGVcbiAgICAgICk7XG4gICAgICBjb25zdCBsYW1iZGFUYXJnZXQgPSBuZXcgdGFyZ2V0cy5MYW1iZGFGdW5jdGlvbihmdW5jdGlvbkxhbWJkYSk7XG5cbiAgICAgIHNjaGVkdWxlcy5mb3JFYWNoKChzY2hlZHVsZSwgaW5kZXgpID0+IHtcbiAgICAgICAgLy8gTGFtYmRhIG5hbWUgd2lsbCBiZSBwcmVwZW5kZWQgdG8gcnVsZSBpZCwgc28gb25seSB1c2luZyBpbmRleCBoZXJlIGZvciB1bmlxdWVuZXNzXG4gICAgICAgIGNvbnN0IHJ1bGUgPSBuZXcgUnVsZShmdW5jdGlvbkxhbWJkYSwgYHNjaGVkdWxlJHtpbmRleH1gLCB7XG4gICAgICAgICAgc2NoZWR1bGUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJ1bGUuYWRkVGFyZ2V0KGxhbWJkYVRhcmdldCk7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3IoXG4gICAgICAgICdGdW5jdGlvblNjaGVkdWxlSW5pdGlhbGl6YXRpb25FcnJvcicsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGluc3RhbnRpYXRlIHNjaGVkdWxlIGZvciBub2RlanMgZnVuY3Rpb24nLFxuICAgICAgICAgIHJlc29sdXRpb246ICdTZWUgdGhlIHVuZGVybHlpbmcgZXJyb3IgbWVzc2FnZSBmb3IgbW9yZSBkZXRhaWxzLicsXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yIGFzIEVycm9yXG4gICAgICApO1xuICAgIH1cblxuICAgIFRhZ3Mub2YoZnVuY3Rpb25MYW1iZGEpLmFkZChUYWdOYW1lLkZSSUVORExZX05BTUUsIGlkKTtcblxuICAgIHRoaXMuZnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3IgPSBuZXcgRnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3IoXG4gICAgICBmdW5jdGlvbkxhbWJkYSxcbiAgICAgIHByb3BzLmVudmlyb25tZW50LFxuICAgICAgYmFja2VuZFNlY3JldFJlc29sdmVyLFxuICAgICAgZnVuY3Rpb25FbnZpcm9ubWVudFR5cGVHZW5lcmF0b3JcbiAgICApO1xuXG4gICAgdGhpcy5yZXNvdXJjZXMgPSB7XG4gICAgICBsYW1iZGE6IGZ1bmN0aW9uTGFtYmRhLFxuICAgICAgY2ZuUmVzb3VyY2VzOiB7XG4gICAgICAgIGNmbkZ1bmN0aW9uOiBmdW5jdGlvbkxhbWJkYS5ub2RlLmZpbmRDaGlsZCgnUmVzb3VyY2UnKSBhcyBDZm5GdW5jdGlvbixcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHRoaXMuc3RvcmVPdXRwdXQob3V0cHV0U3RvcmFnZVN0cmF0ZWd5KTtcblxuICAgIG5ldyBBdHRyaWJ1dGlvbk1ldGFkYXRhU3RvcmFnZSgpLnN0b3JlQXR0cmlidXRpb25NZXRhZGF0YShcbiAgICAgIFN0YWNrLm9mKHRoaXMpLFxuICAgICAgZnVuY3Rpb25TdGFja1R5cGUsXG4gICAgICBmaWxlVVJMVG9QYXRoKG5ldyBVUkwoJy4uL3BhY2thZ2UuanNvbicsIGltcG9ydC5tZXRhLnVybCkpXG4gICAgKTtcbiAgfVxuXG4gIGFkZEVudmlyb25tZW50ID0gKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgQmFja2VuZFNlY3JldCkgPT4ge1xuICAgIHRoaXMuZnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3IuYWRkRW52aXJvbm1lbnRFbnRyeShrZXksIHZhbHVlKTtcbiAgfTtcblxuICBnZXRSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yID0gKCkgPT4gKHtcbiAgICBpZGVudGlmaWVyOiBgJHt0aGlzLm5vZGUuaWR9TGFtYmRhUmVzb3VyY2VBY2Nlc3NBY2NlcHRvcmAsXG4gICAgYWNjZXB0UmVzb3VyY2VBY2Nlc3M6IChcbiAgICAgIHBvbGljeTogUG9saWN5LFxuICAgICAgc3NtRW52aXJvbm1lbnRFbnRyaWVzOiBTc21FbnZpcm9ubWVudEVudHJ5W11cbiAgICApID0+IHtcbiAgICAgIGNvbnN0IHJvbGUgPSB0aGlzLnJlc291cmNlcy5sYW1iZGEucm9sZTtcbiAgICAgIGlmICghcm9sZSkge1xuICAgICAgICAvLyBUaGlzIHNob3VsZCBuZXZlciBoYXBwZW4gc2luY2Ugd2UgYXJlIHVzaW5nIHRoZSBGdW5jdGlvbiBMMiBjb25zdHJ1Y3RcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdObyBleGVjdXRpb24gcm9sZSBmb3VuZCB0byBhdHRhY2ggbGFtYmRhIHBlcm1pc3Npb25zIHRvJ1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcG9saWN5LmF0dGFjaFRvUm9sZShyb2xlKTtcbiAgICAgIHNzbUVudmlyb25tZW50RW50cmllcy5mb3JFYWNoKCh7IG5hbWUsIHBhdGggfSkgPT4ge1xuICAgICAgICB0aGlzLmZ1bmN0aW9uRW52aXJvbm1lbnRUcmFuc2xhdG9yLmFkZFNzbUVudmlyb25tZW50RW50cnkobmFtZSwgcGF0aCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9KTtcblxuICAvKipcbiAgICogU3RvcmUgc3RvcmFnZSBvdXRwdXRzIHVzaW5nIHByb3ZpZGVkIHN0cmF0ZWd5XG4gICAqL1xuICBwcml2YXRlIHN0b3JlT3V0cHV0ID0gKFxuICAgIG91dHB1dFN0b3JhZ2VTdHJhdGVneTogQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneTxGdW5jdGlvbk91dHB1dD5cbiAgKTogdm9pZCA9PiB7XG4gICAgb3V0cHV0U3RvcmFnZVN0cmF0ZWd5LmFwcGVuZFRvQmFja2VuZE91dHB1dExpc3QoZnVuY3Rpb25PdXRwdXRLZXksIHtcbiAgICAgIHZlcnNpb246ICcxJyxcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgZGVmaW5lZEZ1bmN0aW9uczogdGhpcy5yZXNvdXJjZXMubGFtYmRhLmZ1bmN0aW9uTmFtZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH07XG59XG5cbmNvbnN0IGlzV2hvbGVOdW1iZXJCZXR3ZWVuSW5jbHVzaXZlID0gKFxuICB0ZXN0OiBudW1iZXIsXG4gIG1pbjogbnVtYmVyLFxuICBtYXg6IG51bWJlclxuKSA9PiBtaW4gPD0gdGVzdCAmJiB0ZXN0IDw9IG1heCAmJiB0ZXN0ICUgMSA9PT0gMDtcblxuZXhwb3J0IHR5cGUgTm9kZVZlcnNpb24gPSAxNiB8IDE4IHwgMjA7XG5cbmNvbnN0IG5vZGVWZXJzaW9uTWFwOiBSZWNvcmQ8Tm9kZVZlcnNpb24sIFJ1bnRpbWU+ID0ge1xuICAxNjogUnVudGltZS5OT0RFSlNfMTZfWCxcbiAgMTg6IFJ1bnRpbWUuTk9ERUpTXzE4X1gsXG4gIDIwOiBSdW50aW1lLk5PREVKU18yMF9YLFxufTtcbiJdfQ==